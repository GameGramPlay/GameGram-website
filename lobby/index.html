<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tic Tac Toe Online (PeerJS)</title>
  <style>
    body { font-family:sans-serif; display:flex; flex-direction:column; align-items:center; padding:20px; }
    .board { display:grid; grid-template-columns:repeat(3,100px); gap:5px; margin:20px 0; }
    .cell { width:100px; height:100px; background:#f9f9f9; display:flex; justify-content:center; align-items:center;
            font-size:48px; cursor:pointer; border:2px solid #333; }
    #status { margin:10px; font-size:20px; }
    input,button { margin:5px; padding:8px; }
  </style>
</head>
<body>
  <h1>Multiplayer Tic Tac Toe</h1>
  <div>
    <input id="peerIdInput" placeholder="Room ID">
    <button id="hostBtn">Host Game</button>
    <button id="joinBtn">Join Game</button>
  </div>
  <div id="myId"></div>

  <div class="board" id="board"></div>
  <div id="status">Not connected</div>

  <!-- PeerJS (public cloud signaling) -->
  <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
  <script>
    const boardEl = document.getElementById('board');
    const status = document.getElementById('status');
    const myIdEl = document.getElementById('myId');
    const input = document.getElementById('peerIdInput');
    let cells = Array(9).fill(null);
    let turn = 'X';
    let mySymbol = null;
    let conn;

    // Create PeerJS client (auto-generate ID)
    const peer = new Peer();
    peer.on('open', id => {
      myIdEl.textContent = "Your Room ID: " + id;
    });

    // Handle incoming connections (hosting)
    peer.on('connection', c => {
      conn = c;
      mySymbol = 'X';
      setupConn();
    });

    // Join button
    document.getElementById('joinBtn').onclick = () => {
      conn = peer.connect(input.value);
      mySymbol = 'O';
      setupConn();
    };

    // Host button just sets symbol (waiting for others to connect)
    document.getElementById('hostBtn').onclick = () => {
      mySymbol = 'X';
      status.textContent = "Waiting for another player to join...";
    };

    function setupConn() {
      conn.on('open', () => {
        status.textContent = "Connected! You are " + mySymbol;
        render();
      });
      conn.on('data', data => {
        if (data.type === 'move') {
          cells[data.idx] = data.symbol;
          turn = data.symbol === 'X' ? 'O' : 'X';
          render();
        }
      });
    }

    // Build board
    for (let i=0; i<9; i++) {
      let c = document.createElement('div');
      c.className = 'cell';
      c.dataset.i = i;
      c.onclick = () => move(i, c);
      boardEl.appendChild(c);
    }

    function move(i, cell) {
      if (!mySymbol || turn !== mySymbol || cells[i]) return;
      cells[i] = mySymbol;
      conn.send({ type: 'move', idx: i, symbol: mySymbol });
      turn = mySymbol === 'X' ? 'O' : 'X';
      render();
    }

    function render() {
      Array.from(boardEl.children).forEach((c,i)=>c.textContent = cells[i]||'');
      const winner = checkWinner();
      if (winner) {
        status.textContent = (winner==='Draw' ? "It's a draw!" : winner + " wins!");
      } else {
        status.textContent = "Turn: " + turn + " | You are " + mySymbol;
      }
    }

    function checkWinner() {
      const lines=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
      for (let [a,b,c] of lines) if (cells[a] && cells[a]===cells[b] && cells[a]===cells[c]) return cells[a];
      return cells.every(x=>x) ? 'Draw' : null;
    }
  </script>
</body>
</html>
